---
title: Computer Vision - CNN with Transfer Learning
author: Michael Fuchs
date: '2021-01-17'
slug: computer-vision-cnn-with-transfer-learning
categories:
  - R
tags:
  - R Markdown
output:
  blogdown::html_page:
    toc: true
    toc_depth: 5
---


# 1 Introduction

In my post [Computer Vision - Convolutional Neural Network](https://michael-fuchs-python.netlify.app/2021/01/08/computer-vision-convolutional-neural-network/) I showed how to train a Convolutional Neural Network for binary image classification. Now I will try to improve this model again using Transfer Learning. 


For this publication I used the images from the *cats and dogs* dataset from the statistics platform ["Kaggle"](https://www.kaggle.com/c/dogs-vs-cats/data). You can download the used data from my ["GitHub Repository"](https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/Convolutional%20Neural%20Network). 



# 2 Import the libraries

```{r, eval=F, echo=T}
from preprocessing_CNN import Train_Validation_Test_Split

import numpy as np
import pandas as pd

import os
import shutil

import pickle as pk

import cv2 
import matplotlib.pyplot as plt
%matplotlib inline 

from keras import layers
from keras import models
from keras.callbacks import EarlyStopping, ModelCheckpoint
from keras.preprocessing.image import ImageDataGenerator
from keras.models import load_model

from keras.applications import VGG19
```



# 3 Data pre-processing

How the data for a CNN model training must be prepared I have already explained in this post: [Computer Vision - Convolutional Neural Network](https://michael-fuchs-python.netlify.app/2021/01/08/computer-vision-convolutional-neural-network/)

The exact functionality of the code I have explained in this post: [Automate the Boring Stuff](https://michael-fuchs-python.netlify.app/2021/01/01/computer-vision-automate-the-boring-stuff/#train-validation-test-split)

Please download the two folders *cats* and *dogs* from my ["GitHub Repository"](https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/Convolutional%20Neural%20Network) and navigate to the project's root directory in the terminal. The notebook must be started from the location where the two files are stored. 


## 3.1 Train-Validation-Test Split

For this please download the preprocessing_CNN.py file from my ["GitHub Repository"](https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/Convolutional%20Neural%20Network) and place this file next to the folders *cats* and *dogs* and start your Jupyter notebook from here.





```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)








## 3.2 Obtaining the lists of randomly selected images

```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 3.3 Determination of the directories


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 3.4 Obtain the total number of training, validation and test images

```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



# 4 Feature Extraction without Data Augmentation


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.1 Name Definitions


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.2 Parameter Settings


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.3 Instantiating the VGG19 convolutional base


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.4 Feature Extraction


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.4.1 Get Output Shape of last Layer


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.4.2 Extracting features using the pretrained convolutional base


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.4.3 Reshape train-, validation- and test features


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.5 Instantiating a densely connected classifier


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.5.1 Layer Structure


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 4.5.2 Configuring the model for training


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.6 Callbacks


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.7 Fitting the model


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.8 Obtaining the best model values


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.9 Obtaining class assignments


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.10 Validation


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.11 Load best model


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.12 Model Testing


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 4.13 Test Out of the Box Pictures


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



# 5 Feature Extraction with Data Augmentation


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.1 Name Definitions


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.2 Parameter Settings


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.3 Instantiating the VGG19 convolutional base


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.4 Instantiating a densely connected classifier


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 5.4.1 Layer Structure


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 5.4.2 Configuring the model for training


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



### 5.4.3 Using ImageDataGenerator


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.5 Callbacks


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.6 Fitting the model


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.7 Obtaining the best model values


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.8 Obtaining class assignments


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.9 Validation


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.10 Load best model


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.11 Model Testing


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



## 5.12 Test Out of the Box Pictures


```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)















```{r, eval=F, echo=T}

```

![](/post/2021-01-17-computer-vision-cnn-with-transfer-learning_files/p106p.png)



































































































































