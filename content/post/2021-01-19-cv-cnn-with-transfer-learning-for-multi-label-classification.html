---
title: CV - CNN with Transfer Learning for Multi-Label Classification
author: Michael Fuchs
date: '2021-01-19'
slug: cv-cnn-with-transfer-learning-for-multi-label-classification
categories:
  - R
tags:
  - R Markdown
output:
  blogdown::html_page:
    toc: true
    toc_depth: 5
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction">1 Introduction</a></li>
<li><a href="#import-the-libraries">2 Import the libraries</a></li>
<li><a href="#data-pre-processing">3 Data pre-processing</a>
<ul>
<li><a href="#train-validation-test-split">3.1 Train-Validation-Test Split</a></li>
<li><a href="#obtaining-the-lists-of-randomly-selected-images">3.2 Obtaining the lists of randomly selected images</a></li>
<li><a href="#determination-of-the-directories">3.3 Determination of the directories</a></li>
<li><a href="#obtain-the-total-number-of-training-validation-and-test-images">3.4 Obtain the total number of training, validation and test images</a></li>
</ul></li>
<li><a href="#feature-extraction-with-data-augmentation">4 Feature Extraction with Data Augmentation</a>
<ul>
<li><a href="#name-definitions">4.1 Name Definitions</a></li>
<li><a href="#parameter-settings">4.2 Parameter Settings</a></li>
<li><a href="#instantiating-the-vgg19-convolutional-base">4.3 Instantiating the VGG19 convolutional base</a></li>
<li><a href="#instantiating-a-densely-connected-classifier">4.4 Instantiating a densely connected classifier</a>
<ul>
<li><a href="#layer-structure">4.4.1 Layer Structure</a></li>
<li><a href="#configuring-the-model-for-training">4.4.2 Configuring the model for training</a></li>
<li><a href="#using-imagedatagenerator">4.4.3 Using ImageDataGenerator</a></li>
</ul></li>
<li><a href="#callbacks">4.5 Callbacks</a></li>
<li><a href="#fitting-the-model">4.6 Fitting the model</a></li>
<li><a href="#obtaining-the-best-model-values">4.7 Obtaining the best model values</a></li>
<li><a href="#obtaining-class-assignments">4.8 Obtaining class assignments</a></li>
<li><a href="#validation">4.9 Validation</a></li>
<li><a href="#load-best-model">4.10 Load best model</a></li>
<li><a href="#model-testing">4.11 Model Testing</a></li>
<li><a href="#test-out-of-the-box-pictures">4.12 Test Out of the Box Pictures</a></li>
</ul></li>
<li><a href="#conclusion">5 Conclusion</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>1 Introduction</h1>
<p>After showing how to build <a href="https://michael-fuchs-python.netlify.app/2021/01/17/computer-vision-cnn-with-transfer-learning/">binary classification models using transfer learning</a>, I would like to show this again for multiple classification problems.</p>
<p>Once again, I used the <a href="https://keras.io/api/applications/">Keras Application</a> <a href="https://keras.io/api/applications/vgg/#vgg19-function">VGG19</a> for transfer learning.</p>
<p>For this publication I used the images from the <em>Animal Faces</em> dataset from the statistics platform <a href="https://www.kaggle.com/andrewmvd/animal-faces">“Kaggle”</a>. You can download the used data from my <a href="https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/CNN%20for%20Multi%20Label%20Classification">“GitHub Repository”</a>.</p>
</div>
<div id="import-the-libraries" class="section level1">
<h1>2 Import the libraries</h1>
<pre class="r"><code>from preprocessing_multi_CNN import Train_Validation_Test_Split

import numpy as np
import pandas as pd

import os
import shutil

import pickle as pk

import cv2 
import matplotlib.pyplot as plt
%matplotlib inline 

from keras import layers
from keras import models
from keras.callbacks import EarlyStopping, ModelCheckpoint
from keras.preprocessing.image import ImageDataGenerator
from keras.models import load_model

from keras.applications import VGG19</code></pre>
</div>
<div id="data-pre-processing" class="section level1">
<h1>3 Data pre-processing</h1>
<p>How the data for a CNN model training must be prepared I have already explained in this post: <a href="https://michael-fuchs-python.netlify.app/2021/01/15/computer-vision-cnn-for-multi-label-classification/">Computer Vision - CNN for Multi-Label Classification</a></p>
<p>The exact functionality of the code I have explained in this post: <a href="https://michael-fuchs-python.netlify.app/2021/01/01/computer-vision-automate-the-boring-stuff/#train-validation-test-split">Automate the Boring Stuff</a></p>
<p>Please download the folders <em>cats</em>, <em>dogs</em> and <em>wilds</em> from my <a href="https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/CNN%20for%20Multi%20Label%20Classification">“GitHub Repository”</a> and navigate to the project’s root directory in the terminal. The notebook must be started from the location where the three files are stored.</p>
<p>For this please download the preprocessing_multi_CNN.py file from my <a href="https://github.com/MFuchs1989/Datasets-and-Miscellaneous/tree/main/datasets/Computer%20Vision/CNN%20for%20Multi%20Label%20Classification">“GitHub Repository”</a> and place this file next to the folders <em>cats</em>, <em>dogs</em> and *wilds** and start your Jupyter notebook from here.</p>
<div id="train-validation-test-split" class="section level2">
<h2>3.1 Train-Validation-Test Split</h2>
<pre class="r"><code>c_train, d_train, w_train, \
c_val, d_val, w_val, \
c_test, d_test, w_test = Train_Validation_Test_Split(&#39;cats&#39;, &#39;dogs&#39;, &#39;wilds&#39;)</code></pre>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p1.png" /></p>
</div>
<div id="obtaining-the-lists-of-randomly-selected-images" class="section level2">
<h2>3.2 Obtaining the lists of randomly selected images</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="determination-of-the-directories" class="section level2">
<h2>3.3 Determination of the directories</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="obtain-the-total-number-of-training-validation-and-test-images" class="section level2">
<h2>3.4 Obtain the total number of training, validation and test images</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
</div>
<div id="feature-extraction-with-data-augmentation" class="section level1">
<h1>4 Feature Extraction with Data Augmentation</h1>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
<div id="name-definitions" class="section level2">
<h2>4.1 Name Definitions</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="parameter-settings" class="section level2">
<h2>4.2 Parameter Settings</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="instantiating-the-vgg19-convolutional-base" class="section level2">
<h2>4.3 Instantiating the VGG19 convolutional base</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="instantiating-a-densely-connected-classifier" class="section level2">
<h2>4.4 Instantiating a densely connected classifier</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
<div id="layer-structure" class="section level3">
<h3>4.4.1 Layer Structure</h3>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="configuring-the-model-for-training" class="section level3">
<h3>4.4.2 Configuring the model for training</h3>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="using-imagedatagenerator" class="section level3">
<h3>4.4.3 Using ImageDataGenerator</h3>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
</div>
<div id="callbacks" class="section level2">
<h2>4.5 Callbacks</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="fitting-the-model" class="section level2">
<h2>4.6 Fitting the model</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="obtaining-the-best-model-values" class="section level2">
<h2>4.7 Obtaining the best model values</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="obtaining-class-assignments" class="section level2">
<h2>4.8 Obtaining class assignments</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="validation" class="section level2">
<h2>4.9 Validation</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="load-best-model" class="section level2">
<h2>4.10 Load best model</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="model-testing" class="section level2">
<h2>4.11 Model Testing</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
<div id="test-out-of-the-box-pictures" class="section level2">
<h2>4.12 Test Out of the Box Pictures</h2>
<p><img src="/post/2021-01-19-cv-cnn-with-transfer-learning-for-multi-label-classification_files/p107p.png" /></p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>5 Conclusion</h1>
</div>
