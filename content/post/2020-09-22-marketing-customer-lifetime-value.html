---
title: Marketing - Customer Lifetime Value
author: Michael Fuchs
date: '2020-09-22'
slug: marketing-customer-lifetime-value
categories:
  - R
tags:
  - R Markdown
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<div id="table-of-content" class="section level1">
<h1>Table of Content</h1>
<ul>
<li>1 Introduction</li>
<li>2 Import the libraries and the data</li>
<li>3 Data pre-processing</li>
<li>3.1 Negative Quantity</li>
<li>3.2 Missing Values within CustomerID</li>
<li>3.3 Handling incomplete data</li>
<li>3.4 Total Sales</li>
<li>3.5 Create final dataframe</li>
<li>4 Descriptive Analytics</li>
<li>4.1 Final Dataframe for Descriptive Analytics</li>
<li>4.2 Visualizations</li>
<li>5 Predicting 3-Month CLV</li>
<li>5.1 Final Dataframe for Prediction Models</li>
<li>5.2 Building Sample Set</li>
<li>5.3 Train Test Split</li>
<li>5.4 Linear Regression</li>
<li>5.5 Model Evaluation</li>
<li>6 Conclusion</li>
</ul>
</div>
<div id="introduction" class="section level1">
<h1>1 Introduction</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83s1.png" /></p>
<p>In marketing, customer lifetime value is one of the most important metrics to keep in mind.
This metric is especially important to keep track of for acquiring new customers.
The corporate goal of marketing kampagnien is always the acquisition of new customers under the premise of a positive ROI.
For example, if the average CLV of our customer is 100€ and it only costs 50€ to acquire a new customer, then our business will be generationg more revenue as we acquire new customers.
If this is the other way around, our company is making losses. This is to be avoided and for this reason the CLV should always be observed.</p>
<p>There are multiple ways to calculate CLV. One way is to find the customer’s average purchase amount, purchase frequency and lifetime span to do a simple calculation to get the CLV.</p>
<p>Let us assume the following conditions:</p>
<ul>
<li>Customer’s average purchase amount: 100€</li>
<li>Purchase frequency: 5 times per month</li>
</ul>
<p>This makes an average value per month of 500€.
Now let’s come to the lifetime span.
One way to estimate a customer’s lifetime span is to look at the average monthly churn rate, which is the percentage of customers leaving and terminating the relationship whith our business. We can estimate a customer’s lifetime span by dividing one by the churn rate. Assuming 5% of the churn rate, the estimated customer’s lifetime span is 20 years.</p>
<ul>
<li>Lifetime span: 20 years</li>
</ul>
<p>This results in a total amount of 120,000€ (500€ x 20 years x 12 months).</p>
<p>Because we do not typically know the lifetime span of customers, we often try to estimate CLV over the course of a certain period (3 months, 12 months, 24 months …). And that is exactly what we will do in the following.</p>
<p>For this post the dataset <em>Online Retail</em> from the statistic platform <a href="https://www.kaggle.com">“Kaggle”</a> was used. You can download it from my <a href="https://github.com/MFuchs1989/Bdown-Python/tree/master/datasets">“GitHub Repository”</a>.</p>
</div>
<div id="import-the-libraries-and-the-data" class="section level1">
<h1>2 Import the libraries and the data</h1>
<pre class="r"><code>import pandas as pd
import numpy as np


import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn import metrics</code></pre>
<pre class="r"><code>df = pd.read_excel(&#39;Online Retail.xlsx&#39;, sheet_name=&#39;Online Retail&#39;)
df</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p1.png" /></p>
</div>
<div id="data-pre-processing" class="section level1">
<h1>3 Data pre-processing</h1>
</div>
<div id="negative-quantity" class="section level1">
<h1>3.1 Negative Quantity</h1>
<pre class="r"><code>&#39;&#39;&#39;
Canceled orders could cause negative values in the data record.
To be on the safe side, these are removed.
&#39;&#39;&#39;

df = df.loc[df[&#39;Quantity&#39;] &gt; 0]
df.shape</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p2.png" /></p>
<p>As we can see from the output, this was not the case in this record.</p>
</div>
<div id="missing-values-within-customerid" class="section level1">
<h1>3.2 Missing Values within CustomerID</h1>
<pre class="r"><code>&#39;&#39;&#39;
We need to drop observations with no CustomerID
&#39;&#39;&#39;

df = df[pd.notnull(df[&#39;CustomerID&#39;])]
df.shape</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p3.png" /></p>
</div>
<div id="handling-incomplete-data" class="section level1">
<h1>3.3 Handling incomplete data</h1>
<pre class="r"><code>print(&#39;Invoice Date Range: %s - %s&#39; % (df[&#39;InvoiceDate&#39;].min(), df[&#39;InvoiceDate&#39;].max()))</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p4.png" /></p>
<pre class="r"><code>&#39;&#39;&#39;
Due to the fact that we only need full months for future analysis, we will shorten this data set accordingly.
&#39;&#39;&#39;

df = df.loc[df[&#39;InvoiceDate&#39;] &lt; &#39;2011-12-01&#39;]
df.shape</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p5.png" /></p>
</div>
<div id="total-sales" class="section level1">
<h1>3.4 Total Sales</h1>
<pre class="r"><code>&#39;&#39;&#39;
For further analysis we need another column Sales.
&#39;&#39;&#39;
df[&#39;Sales&#39;] = df[&#39;Quantity&#39;] * df[&#39;UnitPrice&#39;]
df.head()</code></pre>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p6.png" /></p>
</div>
<div id="create-final-dataframe" class="section level1">
<h1>3.5 Create final dataframe</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="descriptive-analytics" class="section level1">
<h1>4 Descriptive Analytics</h1>
</div>
<div id="final-dataframe-for-descriptive-analytics" class="section level1">
<h1>4.1 Final Dataframe for Descriptive Analytics</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="visualizations" class="section level1">
<h1>4.2 Visualizations</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="predicting-3-month-clv" class="section level1">
<h1>5 Predicting 3-Month CLV</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="final-dataframe-for-prediction-models" class="section level1">
<h1>5.1 Final Dataframe for Prediction Models</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="building-sample-set" class="section level1">
<h1>5.2 Building Sample Set</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="train-test-split" class="section level1">
<h1>5.3 Train Test Split</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="linear-regression" class="section level1">
<h1>5.4 Linear Regression</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="model-evaluation" class="section level1">
<h1>5.5 Model Evaluation</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="conclusion" class="section level1">
<h1>6 Conclusion</h1>
<p><img src="/post/2020-09-22-marketing-customer-lifetime-value_files/p83p.png" /></p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Besemer, S. P. (1998). Creative product analysis matrix: testing the model structure and a comparison among products–three novel chairs. Creativity Research Journal, 11(4), 333-346.</p>
<p>Do Ruibin, K., &amp; Vintilescu Borglöv, T. (2018). Predicting Customer Lifetime Value: Understanding its accuracy and drivers from a frequent flyer program perspective.</p>
<p>Glady, N., Baesens, B., &amp; Croux, C. (2009). Modeling churn using customer lifetime value. European Journal of Operational Research, 197(1), 402-411.</p>
<p>Hwang, Y. (2019). Hands-On Data Science for Marketing: Improve your marketing strategies with machine learning using Python and R. Packt Publishing Ltd.</p>
<p>Johnston, B., Jones, A. &amp; Kruger, C. (2019). Applied Unsupervised Learning with Python : Discover hidden patterns and relationships in unstructured data with Python.
Packt Publishing Ltd.</p>
<p>Miller, T. W. (2015). Marketing data science: modeling techniques in predictive analytics with R and Python. FT Press.</p>
<p>Provost, F., &amp; Fawcett, T. (2013). Data Science for Business: What you need to know about data mining and data-analytic thinking. " O’Reilly Media, Inc.".</p>
<p>Wedel, M., Kamakura, W., &amp; Böckenholt, U. (2000). Marketing data, models and decisions. International Journal of Research in Marketing, 17(2-3), 203-208.</p>
<p>Xu, Z., Frankwick, G. L., &amp; Ramirez, E. (2016). Effects of big data analytics and traditional marketing analytics on new product success: A knowledge fusion perspective. Journal of Business Research, 69(5), 1562-1566.</p>
</div>
