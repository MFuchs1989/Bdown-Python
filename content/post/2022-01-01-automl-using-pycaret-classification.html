---
title: AutoML using PyCaret - Classification
author: Michael Fuchs
date: '2022-01-01'
slug: automl-using-pycaret-classification
categories: []
tags: []
output:
  blogdown::html_page:
    toc: true
    toc_depth: 5
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction">1 Introduction</a></li>
<li><a href="#loading-the-libraries-and-data">2 Loading the Libraries and Data</a></li>
<li><a href="#pycaret---classification">3 PyCaret - Classification</a>
<ul>
<li><a href="#setup">3.1 Setup</a></li>
<li><a href="#compare-models">3.2 Compare Models</a>
<ul>
<li><a href="#comparison-of-specific-models">3.2.1 Comparison of Specific Models</a></li>
<li><a href="#further-settings">3.2.2 Further Settings</a></li>
</ul></li>
<li><a href="#model-evaluation">3.3 Model Evaluation</a></li>
<li><a href="#model-training">3.4 Model Training</a></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>1 Introduction</h1>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133s1.png" /></p>
<p>Source: <a href="https://github.com/pycaret">PyCaret-GitHub</a></p>
<p>Data Scientists tend to make their tasks more and more effective and efficient. This also applies to the field of machine learning model training.
There is a wide range of algorithms that can be used for regression and classification problems.
<a href="https://michael-fuchs-python.netlify.app/2021/05/11/machine-learning-pipelines/">Machine Learning Pipelines</a> have helped to simplify and speed up the process of finding the best model.</p>
<p>Now we come to the next stage: <strong>Automated Machine Learning Libraries</strong></p>
<p>In my research, I came across <a href="https://pycaret.org/"><strong>PyCaret</strong></a> in this regard.</p>
<p><a href="https://pycaret.org/">PyCaret is an open-source, low-code machine learning library in Python that automates machine learning workflows.</a></p>
<p>It can be used to work on the following problems:</p>
<ul>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#classification">Classification</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#regression">Regression</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#clustering">Clustering</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#anomaly-detection">Anomaly Detection</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#natural-language-processing">Natural Language Processing</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#association-rules-mining">Association Rules Mining</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/quickstart#time-series-beta">Time Series (beta)</a></li>
</ul>
<p>When I read through the <a href="https://pycaret.gitbook.io/docs/">GitBook</a> and the <a href="https://pycaret.readthedocs.io/en/latest/">API Reference</a> PyCaret was very promising and I can say I was not disappointed.</p>
<p>In the following I will show how to create a classification algorithm with PyCaret and what other possibilities you have with this AutoML library.</p>
</div>
<div id="loading-the-libraries-and-data" class="section level1">
<h1>2 Loading the Libraries and Data</h1>
<pre class="r"><code>import pandas as pd
import numpy as np

import pycaret.classification as pycc</code></pre>
<pre class="r"><code>class Color:
   PURPLE = &#39;\033[95m&#39;
   CYAN = &#39;\033[96m&#39;
   DARKCYAN = &#39;\033[36m&#39;
   BLUE = &#39;\033[94m&#39;
   GREEN = &#39;\033[92m&#39;
   YELLOW = &#39;\033[93m&#39;
   RED = &#39;\033[91m&#39;
   BOLD = &#39;\033[1m&#39;
   UNDERLINE = &#39;\033[4m&#39;
   END = &#39;\033[0m&#39;</code></pre>
<pre class="r"><code>bird_df = pd.read_csv(&#39;bird.csv&#39;).drop(&#39;id&#39;, axis=1)
bird_df.head()</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p1.png" /></p>
<pre class="r"><code>bird_df.isnull().sum()</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p2.png" /></p>
</div>
<div id="pycaret---classification" class="section level1">
<h1>3 PyCaret - Classification</h1>
<div id="setup" class="section level2">
<h2>3.1 Setup</h2>
<p>As a first step, I initialize the training environment. At the same time, the transformation pipeline is created.
This setup function takes two parameters:</p>
<ul>
<li>the dataset</li>
<li>the target variable</li>
</ul>
<pre class="r"><code>summary_preprocess = pycc.setup(bird_df, target = &#39;type&#39;)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p3.png" /></p>
<p>First we can check if the data types of all variables were recognized correctly. If this is the case, as here, we can press Enter.</p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p4.png" /></p>
<p>Now we get a detailed overview (only a part of it is shown here) of the initialized setup and the performed transformation steps of the pipeline.</p>
<p>Default Transformations:</p>
<ul>
<li>Missing Value Imputation</li>
<li>Perfect Collinearity Removal</li>
<li>One-Hot Encoding</li>
<li>Train-Test Split</li>
</ul>
<p>All transformations can be set individually in the setup function. See here: <a href="https://pycaret.gitbook.io/docs/get-started/preprocessing">PyCaret Official - Preprocessing</a></p>
<p>These include:</p>
<ul>
<li><a href="https://pycaret.gitbook.io/docs/get-started/preprocessing/data-preparation">Data Preparation</a>
<ul>
<li>Missing Values</li>
<li>Data Types</li>
<li>Encoding</li>
</ul></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/preprocessing/scale-and-transform">Scale and Transform</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/preprocessing/feature-engineering">Feature Engineering</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/preprocessing/feature-selection">Feature Selection</a> and</li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/preprocessing/other-setup-parameters">Other Parameters</a></li>
</ul>
<p>Use these preprocessing and transformation parameters in the setup as needed for your present data set. In my example I leave it at the default settings.</p>
<p>Using the get_config function we can view the edited record.</p>
<pre class="r"><code>x = pycc.get_config(&#39;X&#39;)
y = pycc.get_config(&#39;y&#39;)
trainX = pycc.get_config(&#39;X_train&#39;)
testX = pycc.get_config(&#39;X_test&#39;)
trainY = pycc.get_config(&#39;y_train&#39;)
testY = pycc.get_config(&#39;y_test&#39;)</code></pre>
<pre class="r"><code>x</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p5.png" /></p>
<pre class="r"><code>y</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p6.png" /></p>
<p>Here we see how the target variable ‘type’ has been recoded to apply machine learning algorithms. This step can also be seen in the summary_preprocess in line 4 (index 3).</p>
<p>If you want to get other values or information from the initiated setup here is a list of variables that can be retrieved using the get_config function: <a href="https://pycaret.gitbook.io/docs/get-started/functions/others#get_config">Variables accessible by get_config function</a></p>
</div>
<div id="compare-models" class="section level2">
<h2>3.2 Compare Models</h2>
<p>Now that all preprocessing steps are completed, we can check the performance of the classification algorithms available in PyCaret.</p>
<pre class="r"><code>available_models = pycc.models()
available_models</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p7.png" /></p>
<p>Now let’s compare these models:</p>
<pre class="r"><code>best_clf = pycc.compare_models()</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p8.png" /></p>
<p>Another nice thing about this view is that the best values of each metric are highlighted in yellow. The Extra Trees Classifier achieved the highest value for almost every metric, so all highlighted fields are listed under this algorithm.</p>
<p>Let’s take a detailed look at the best model from the comparison:</p>
<pre class="r"><code>print(best_clf)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p9.png" /></p>
<p><strong>Changing the sort order</strong></p>
<p>Of course, the highest Accuracy is not always the decisive metric, so sorting can also be done according to other evaluation metrics. Here, for example, the syntax to sort by AUC score:</p>
<p><code>best_clf_AUC = pycc.compare_models(sort = 'AUC')</code></p>
<div id="comparison-of-specific-models" class="section level3">
<h3>3.2.1 Comparison of Specific Models</h3>
<p>Since model training can take different amounts of time, depending on the size of the data set, it is sometimes advisable to compare only certain models.</p>
<pre class="r"><code>best_clf_specific = pycc.compare_models(include = [&#39;ada&#39;, &#39;svm&#39;, &#39;nb&#39;])</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p10.png" /></p>
<p><strong>Exclusion of specific models:</strong></p>
<p>Alternatively, certain models can simply be excluded from the performance comparison. See the following syntax:</p>
<p><code>best_clf_excl = pycc.compare_models(exclude = ['dummy', 'ridge'])</code></p>
</div>
<div id="further-settings" class="section level3">
<h3>3.2.2 Further Settings</h3>
<p>In PyCaret you have the possibility to make further settings in the model comparison. These are:</p>
<ul>
<li><a href="https://pycaret.gitbook.io/docs/get-started/functions/train#set-the-budget-time">Setting the Budget Time</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/functions/train#set-the-probability-threshold">Setting the Probability Threshold</a></li>
<li><a href="https://pycaret.gitbook.io/docs/get-started/functions/train#disable-cross-validation">Disable Cross-Validation</a></li>
</ul>
<p>The syntax to these settings would look like this:</p>
<p><code>best_clf_further_settings = pycc.compare_models(budget_time = 0.7,                                                  probability_threshold = 0.75,                                                  cross_validation=False)</code></p>
</div>
</div>
<div id="model-evaluation" class="section level2">
<h2>3.3 Model Evaluation</h2>
<p>Now that we have seen in our comparison (best_clf) that the Extra Trees Classifier has achieved the best values, I would like to go into the evaluation for this algorithm.</p>
<pre class="r"><code>print(best_clf)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p11.png" /></p>
<pre class="r"><code>evaluation_best_clf = pycc.evaluate_model(best_clf)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p12.png" /></p>
<p>Since the evaluate_model function can only be used in notebooks, the plot_model function can also be used as an alternative.</p>
<pre class="r"><code>pycc.plot_model(best_clf, plot = &#39;auc&#39;)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p13.png" /></p>
<pre class="r"><code>pycc.plot_model(best_clf, plot = &#39;confusion_matrix&#39;)</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p14.png" /></p>
<pre class="r"><code>pycc.plot_model(best_clf, 
                plot = &#39;confusion_matrix&#39;, 
                plot_kwargs = {&#39;percent&#39; : True})</code></pre>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p15.png" /></p>
<p><strong>Saving image files</strong></p>
<p>If you want to save the output graphics in PyCaret, you have to set the safe parameter to True.
The syntax would look like this:</p>
<p><code>pycc.plot_model(best_clf,                  plot = 'confusion_matrix',                  plot_kwargs = {'percent' : True},                 save = True)</code></p>
<p>Here is an overview of possible graphics in PyCaret: <a href="https://pycaret.gitbook.io/docs/get-started/functions/analyze#examples-by-module">Examples by module</a></p>
</div>
<div id="model-training" class="section level2">
<h2>3.4 Model Training</h2>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
<p><img src="/post/2022-01-01-automl-using-pycaret-classification_files/p133p.png" /></p>
</div>
</div>
